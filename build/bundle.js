!function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function i(t){return"function"==typeof t}function r(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}const s="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function l(t,e){t.appendChild(e)}function c(t,e,n){t.insertBefore(e,n||null)}function u(t){t.parentNode&&t.parentNode.removeChild(t)}function f(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function a(t){return document.createElement(t)}function h(t){return document.createTextNode(t)}function g(){return h(" ")}function p(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function d(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function m(t,e){e=""+e,t.data!==e&&(t.data=e)}let $;function w(t){$=t}function y(){const t=function(){if(!$)throw new Error("Function called outside component initialization");return $}();return(e,n,{cancelable:o=!1}={})=>{const i=t.$$.callbacks[e];if(i){const r=function(t,e,{bubbles:n=!1,cancelable:o=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:o})}(e,n,{cancelable:o});return i.slice().forEach((e=>{e.call(t,r)})),!r.defaultPrevented}return!0}}const v=[],b=[];let x=[];const _=[],k=Promise.resolve();let B=!1;function M(t){x.push(t)}const E=new Set;let P=0;function j(){if(0!==P)return;const t=$;do{try{for(;P<v.length;){const t=v[P];P++,w(t),L(t.$$)}}catch(t){throw v.length=0,P=0,t}for(w(null),v.length=0,P=0;b.length;)b.pop()();for(let t=0;t<x.length;t+=1){const e=x[t];E.has(e)||(E.add(e),e())}x.length=0}while(v.length);for(;_.length;)_.pop()();B=!1,E.clear(),w(t)}function L(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(M)}}const z=new Set;let A;function C(t,e){t&&t.i&&(z.delete(t),t.i(e))}function S(t,e,n,o){if(t&&t.o){if(z.has(t))return;z.add(t),A.c.push((()=>{z.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}else o&&o()}function I(t){return void 0!==t?.length?t:Array.from(t)}function N(t,e){t.d(1),e.delete(t.key)}function W(t){t&&t.c()}function q(t,n,r){const{fragment:s,after_update:l}=t.$$;s&&s.m(n,r),M((()=>{const n=t.$$.on_mount.map(e).filter(i);t.$$.on_destroy?t.$$.on_destroy.push(...n):o(n),t.$$.on_mount=[]})),l.forEach(M)}function O(t,e){const n=t.$$;null!==n.fragment&&(!function(t){const e=[],n=[];x.forEach((o=>-1===t.indexOf(o)?e.push(o):n.push(o))),n.forEach((t=>t())),x=e}(n.after_update),o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function T(t,e){-1===t.$$.dirty[0]&&(v.push(t),B||(B=!0,k.then(j)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function D(e,i,r,s,l,c,f=null,a=[-1]){const h=$;w(e);const g=e.$$={fragment:null,ctx:[],props:c,update:t,not_equal:l,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(h?h.$$.context:[])),callbacks:n(),dirty:a,skip_bound:!1,root:i.target||h.$$.root};f&&f(g.root);let p=!1;if(g.ctx=r?r(e,i.props||{},((t,n,...o)=>{const i=o.length?o[0]:n;return g.ctx&&l(g.ctx[t],g.ctx[t]=i)&&(!g.skip_bound&&g.bound[t]&&g.bound[t](i),p&&T(e,t)),n})):[],g.update(),p=!0,o(g.before_update),g.fragment=!!s&&s(g.ctx),i.target){if(i.hydrate){const t=function(t){return Array.from(t.childNodes)}(i.target);g.fragment&&g.fragment.l(t),t.forEach(u)}else g.fragment&&g.fragment.c();i.intro&&C(e.$$.fragment),q(e,i.target,i.anchor),j()}w(h)}class F{$$=void 0;$$set=void 0;$destroy(){O(this,1),this.$destroy=t}$on(e,n){if(!i(n))return t;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const t=o.indexOf(n);-1!==t&&o.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function H(t,e){let n=0;if(void 0===e)for(let e of t)(e=+e)&&(n+=e);else{let o=-1;for(let i of t)(i=+e(i,++o,t))&&(n+=i)}return n}"undefined"!=typeof window&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");var R=(t,e)=>(t.weight||1/0)-(e.weight||1/0);const{Map:G}=s;function J(t,e,n){const o=t.slice();return o[10]=e[n],o}function K(t){let e,n,o;function i(){return t[6](t[10])}return{c(){e=a("button"),e.textContent="Ajouter"},m(t,r){c(t,e,r),n||(o=p(e,"click",i),n=!0)},p(e,n){t=e},d(t){t&&u(e),n=!1,o()}}}function Q(t){let e,n,o,i;function r(...e){return t[5](t[10],...e)}return{c(){e=a("input"),d(e,"type","number"),d(e,"step","1"),d(e,"min","1"),e.value=n=t[10].weight,d(e,"class","svelte-92ooh8")},m(t,n){c(t,e,n),o||(i=p(e,"input",r),o=!0)},p(o,i){t=o,2&i&&n!==(n=t[10].weight)&&e.value!==n&&(e.value=n)},d(t){t&&u(e),o=!1,i()}}}function U(t,e){let n,o,i,r,s,f,p,$=e[10].item.text+"";function w(t,e){return t[10].weight?Q:K}let y=w(e),v=y(e);return{key:t,first:null,c(){n=a("li"),o=a("span"),i=h($),r=g(),s=a("span"),f=h("weight: \n                "),v.c(),p=g(),d(s,"class","weight svelte-92ooh8"),d(n,"class","svelte-92ooh8"),this.first=n},m(t,e){c(t,n,e),l(n,o),l(o,i),l(n,r),l(n,s),l(s,f),v.m(s,null),l(n,p)},p(t,n){e=t,2&n&&$!==($=e[10].item.text+"")&&m(i,$),y===(y=w(e))&&v?v.p(e,n):(v.d(1),v=y(e),v&&(v.c(),v.m(s,null)))},d(t){t&&u(n),v.d()}}}function V(e){let n,i,r,s,f,p=[],$=new G,w=I(e[1]);const y=t=>t[10].item;for(let t=0;t<w.length;t+=1){let n=J(e,w,t),o=y(n);$.set(o,p[t]=U(o,n))}return{c(){n=a("section"),i=a("h3"),r=h(e[0]),s=g(),f=a("ol");for(let t=0;t<p.length;t+=1)p[t].c();d(f,"class","svelte-92ooh8"),d(n,"class","svelte-92ooh8")},m(t,e){c(t,n,e),l(n,i),l(i,r),l(n,s),l(n,f);for(let t=0;t<p.length;t+=1)p[t]&&p[t].m(f,null)},p(t,[e]){1&e&&m(r,t[0]),14&e&&(w=I(t[1]),p=function(t,e,n,i,r,s,l,c,u,f,a,h){let g=t.length,p=s.length,d=g;const m={};for(;d--;)m[t[d].key]=d;const $=[],w=new Map,y=new Map,v=[];for(d=p;d--;){const t=h(r,s,d),o=n(t);let c=l.get(o);c?i&&v.push((()=>c.p(t,e))):(c=f(o,t),c.c()),w.set(o,$[d]=c),o in m&&y.set(o,Math.abs(d-m[o]))}const b=new Set,x=new Set;function _(t){C(t,1),t.m(c,a),l.set(t.key,t),a=t.first,p--}for(;g&&p;){const e=$[p-1],n=t[g-1],o=e.key,i=n.key;e===n?(a=e.first,g--,p--):w.has(i)?!l.has(o)||b.has(o)?_(e):x.has(i)?g--:y.get(o)>y.get(i)?(x.add(o),_(e)):(b.add(i),g--):(u(n,l),g--)}for(;g--;){const e=t[g];w.has(e.key)||u(e,l)}for(;p;)_($[p-1]);return o(v),$}(p,e,y,1,t,w,$,f,N,U,null,J))},i:t,o:t,d(t){t&&u(n);for(let t=0;t<p.length;t+=1)p[t].d()}}}function X(t,e,n){let o,{name:i}=e,{weightByItem:r}=e;const s=y();function l(t){t.sort(R);const e=new Map(t.map((({item:t,weight:e})=>[t,e])));s("priorisation-change",e)}function c(t){const e=Math.max(...o.map((({weight:t})=>t||0)));t.weight=e+1,t.previousWeight=t.weight,l(o)}function u(t,e){const{item:n,previousWeight:i}=t;t.weight=e;const s=o.find((({item:t})=>t!==n&&r.get(t)===e))?.item;if(s)if(r.get(s)<i){const t=o.filter((({item:t})=>t!==n&&r.get(t)>=r.get(s)&&r.get(t)<i));console.log("itemsToAdjust",t,r.get(s),i);for(const e of t)e.weight=e.weight+1,e.previousWeight=e.weight}else{const t=o.filter((({item:t})=>t!==n&&r.get(t)<=r.get(s)&&r.get(t)>i));for(const e of t)e.weight=e.weight-1,e.previousWeight=e.weight}t.previousWeight=t.weight,l(o)}return t.$$set=t=>{"name"in t&&n(0,i=t.name),"weightByItem"in t&&n(4,r=t.weightByItem)},t.$$.update=()=>{16&t.$$.dirty&&n(1,o=[...r].map((([t,e])=>({item:t,weight:e,previousWeight:e}))).sort((({weight:t},{weight:e})=>t-e)))},[i,o,c,u,r,(t,e)=>u(t,Number(e.target.value)),t=>c(t)]}class Y extends F{constructor(t){super(),D(this,t,X,V,r,{name:0,weightByItem:4})}}function Z(t,e,n){const o=t.slice();return o[3]=e[n].item.text,o[4]=e[n].weights,o}function tt(t){let e,n,o,i=t[4].filter(t[2]).sort(ot).join(", ")+"";return{c(){e=a("span"),n=h("weight: "),o=h(i),d(e,"class","weight svelte-lq25yr")},m(t,i){c(t,e,i),l(e,n),l(e,o)},p(t,e){1&e&&i!==(i=t[4].filter(t[2]).sort(ot).join(", ")+"")&&m(o,i)},d(t){t&&u(e)}}}function et(t){let e,n,o,i,r,s=t[3]+"",f=t[4].some(t[1]),p=f&&tt(t);return{c(){e=a("li"),n=a("span"),o=h(s),i=g(),p&&p.c(),r=g(),d(e,"class","svelte-lq25yr")},m(t,s){c(t,e,s),l(e,n),l(n,o),l(e,i),p&&p.m(e,null),l(e,r)},p(t,n){1&n&&s!==(s=t[3]+"")&&m(o,s),1&n&&(f=t[4].some(t[1])),f?p?p.p(t,n):(p=tt(t),p.c(),p.m(e,r)):p&&(p.d(1),p=null)},d(t){t&&u(e),p&&p.d()}}}function nt(e){let n,o,i,r,s=I(e[0]),h=[];for(let t=0;t<s.length;t+=1)h[t]=et(Z(e,s,t));return{c(){n=a("section"),o=a("h2"),o.textContent="Priorisation collective",i=g(),r=a("ol");for(let t=0;t<h.length;t+=1)h[t].c();d(r,"class","svelte-lq25yr")},m(t,e){c(t,n,e),l(n,o),l(n,i),l(n,r);for(let t=0;t<h.length;t+=1)h[t]&&h[t].m(r,null)},p(t,[e]){if(1&e){let n;for(s=I(t[0]),n=0;n<s.length;n+=1){const o=Z(t,s,n);h[n]?h[n].p(o,e):(h[n]=et(o),h[n].c(),h[n].m(r,null))}for(;n<h.length;n+=1)h[n].d(1);h.length=s.length}},i:t,o:t,d(t){t&&u(n),f(h,t)}}}const ot=(t,e)=>t-e;function it(t,e,n){let{priorizedList:o}=e;return t.$$set=t=>{"priorizedList"in t&&n(0,o=t.priorizedList)},[o,t=>t!==1/0,t=>t!==1/0]}class rt extends F{constructor(t){super(),D(this,t,it,nt,r,{priorizedList:0})}}function st(t,e,n){const o=t.slice();return o[8]=e[n][0],o[9]=e[n][1],o}function lt(t){let e,n;return e=new Y({props:{name:t[8],weightByItem:t[9]}}),e.$on("priorisation-change",(function(...e){return t[5](t[8],...e)})),{c(){W(e.$$.fragment)},m(t,o){q(e,t,o),n=!0},p(n,o){t=n;const i={};1&o&&(i.name=t[8]),1&o&&(i.weightByItem=t[9]),e.$set(i)},i(t){n||(C(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){O(e,t)}}}function ct(t){let e,n,i,r,s,h,m,$,w,y,v,b,x,_;r=new rt({props:{priorizedList:t[1]}});let k=I([...t[0]]),B=[];for(let e=0;e<k.length;e+=1)B[e]=lt(st(t,k,e));const M=t=>S(B[t],1,1,(()=>{B[t]=null}));return{c(){e=a("h1"),e.textContent="Priorisation collective - vue omnisciente",n=g(),i=a("section"),W(r.$$.fragment),s=g(),h=a("section"),m=a("h2"),m.textContent="Priorisation par personne",$=g(),w=a("section");for(let t=0;t<B.length;t+=1)B[t].c();y=g(),v=a("form"),v.innerHTML='<label>Nom <input name="person-name" type="text" class="svelte-1l3giwi"/></label> <button type="submit">Rajouter une personne</button>',d(v,"class","svelte-1l3giwi"),d(w,"class","per-person svelte-1l3giwi"),d(i,"class","omni svelte-1l3giwi")},m(o,u){c(o,e,u),c(o,n,u),c(o,i,u),q(r,i,null),l(i,s),l(i,h),l(h,m),l(h,$),l(h,w);for(let t=0;t<B.length;t+=1)B[t]&&B[t].m(w,null);var f;l(w,y),l(w,v),b=!0,x||(_=p(v,"submit",(f=t[6],function(t){return t.preventDefault(),f.call(this,t)})),x=!0)},p(t,[e]){const n={};if(2&e&&(n.priorizedList=t[1]),r.$set(n),5&e){let n;for(k=I([...t[0]]),n=0;n<k.length;n+=1){const o=st(t,k,n);B[n]?(B[n].p(o,e),C(B[n],1)):(B[n]=lt(o),B[n].c(),C(B[n],1),B[n].m(w,y))}for(A={r:0,c:[],p:A},n=k.length;n<B.length;n+=1)M(n);A.r||o(A.c),A=A.p}},i(t){if(!b){C(r.$$.fragment,t);for(let t=0;t<k.length;t+=1)C(B[t]);b=!0}},o(t){S(r.$$.fragment,t),B=B.filter(Boolean);for(let t=0;t<B.length;t+=1)S(B[t]);b=!1},d(t){t&&(u(e),u(n),u(i)),O(r),f(B,t),x=!1,_()}}}function ut(t,e,n){let o,{items:i}=e,{priorisationByPerson:r}=e;function s(t,{detail:e}){r.set(t,e),n(0,r)}function l(t){r.set(t,new Map(i.map((t=>[t,void 0])))),n(0,r)}return t.$$set=t=>{"items"in t&&n(4,i=t.items),"priorisationByPerson"in t&&n(0,r=t.priorisationByPerson)},t.$$.update=()=>{1&t.$$.dirty&&n(1,o=function(t){const e=new Map;for(const n of t.values())for(const[t,o]of n){let n=e.get(t)||[];e.set(t,n.concat([o||1/0]))}return[...e].map((([t,e])=>({item:t,weights:e}))).sort((({weights:t},{weights:e})=>{const n=t.filter((t=>t===1/0)).length,o=e.filter((t=>t===1/0)).length;if(n!==o)return n-o;H(t.filter((t=>t!==1/0))),H(e.filter((t=>t!==1/0)))}))}(r))},[r,o,s,l,i,(t,e)=>s(t,e),t=>l(t.target.elements["person-name"].value)]}const ft=["🍇","🍈","🍉","🍊","🍋","🍌","🍍"].map(((t,e)=>Object.freeze({id:Math.random().toString(36).slice(2),text:`Manger #${e+1} - ${t}`})));new class extends F{constructor(t){super(),D(this,t,ut,ct,r,{items:4,priorisationByPerson:0})}}({target:document.querySelector("main"),props:{items:ft,priorisationByPerson:new Map}})}();
//# sourceMappingURL=bundle.js.map
